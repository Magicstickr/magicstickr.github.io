<!-- <iframe width="560" height="315" src="https://www.youtube.com/embed/SZ2rjudcD4s" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
 -->
<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<!-- three.js library -->
		<script src='lib/three.min.js'></script>
		<script src="lib/ar.min.js"></script>
		<script src="lib/GLTFLoader.js"></script>
		<script src="lib/WebGL.js"></script>
		<script src="lib/OrbitControls.js"></script>
		<script src="lib/CSS3DRenderer.js"></script>
		<title>Your letter from the future</title>
	</head>
	<body style='margin : 0px; overflow: hidden; font-family: Monospace;'>
		<div id="container"></div>

		<script>
		//////////////////////////////////////////////////////////////////////////////////
		//		Init
		//////////////////////////////////////////////////////////////////////////////////

		//Error if not WebGL compatible
		if ( WEBGL.isWebGLAvailable() === false ) {
				document.body.appendChild( WEBGL.getWebGLErrorMessage() );
		}

		// create CSS3D IFrameElements
		var IFrameElement = function ( id, x, y, z, ry ) {

			var div = document.createElement( 'div' );
			div.style.width = '480px';
			div.style.height = '360px';
			div.style.backgroundColor = '#000';

			var iframe = document.createElement( 'iframe' );
			iframe.style.width = '480px';
			iframe.style.height = '360px';
			iframe.style.border = '0px';
			iframe.src = [ 'https://www.youtube.com/embed/', id, '?rel=0' ].join( '' );
			div.appendChild( iframe );

			var object = new THREE.CSS3DObject( div );
			object.position.set( x, y, z );
			object.rotation.y = ry;

			return object;
		};

		var Image = function ( id, x, y, z, ry ){

			var div = document.createElement( 'div' );
			div.style.width = '1000px';
			div.style.height = '1000px';
			//div.style.backgroundColor = '#000';

			var img = document.createElement( 'img' );
			img.style.width = '1000px';
			img.style.height = '1000px';
			img.style.border = '0px';
			img.src = id;
			img.alt="logo";
			div.appendChild( img );

			var object = new THREE.CSS3DObject( div );
			object.position.set( x, y, z );
			object.rotation.x = ry;

			return object;
		}

		var Floor = function ( id, x, y, z, ry ){

			var div = document.createElement( 'div' );
			div.style.width = '6000px';
			div.style.height = '6000px';
			//div.style.backgroundColor = '#000';

			var img = document.createElement( 'img' );
			img.style.width = '6000px';
			img.style.height = '6000px';
			img.style.border = '0px';
			img.src = id;
			img.alt="logo";
			div.appendChild( img );

			var object = new THREE.CSS3DObject( div );
			object.position.set( x, y, z );
			object.rotation.x = ry;

			return object;
		}

		// init the html div container
		var container = document.getElementById( 'container' );

		// init renderer
		var renderer = new THREE.CSS3DRenderer();
		renderer.setSize( window.innerWidth, window.innerHeight );
		container.appendChild( renderer.domElement );

		// array of functions for the rendering loop
		var onRenderFcts= [];

		// init scene and camera
		var arWorldRoot	= new THREE.Scene();
		
		//////////////////////////////////////////////////////////////////////////////////
		//		Initialize a basic camera
		//////////////////////////////////////////////////////////////////////////////////

		// Create a camera
		var camera = new THREE.PerspectiveCamera( 50, window.innerWidth / window.innerHeight, 1, 5000 );
		camera.position.set( 500, 800, 1500 );

		arWorldRoot.add(camera);

		// controls
		controls = new THREE.OrbitControls( camera, renderer.domElement );

		//controls.addEventListener( 'change', render ); // call this only in static scenes (i.e., if there is no animation loop)

		controls.enableDamping = true; // an animation loop is required when either damping or auto-rotation are enabled
		controls.dampingFactor = 0.25;

		controls.screenSpacePanning = false;

		controls.minDistance = 0;
		controls.maxDistance = 50000;

		controls.maxPolarAngle = Math.PI / 2;

		//////////////////////////////////////////////////////////////////////////////////
		//		Add the objects in the scene
		//////////////////////////////////////////////////////////////////////////////////

		var group = new THREE.Group();
		group.add( new IFrameElement( 'SZ2rjudcD4s', 0, 280, 240, 0 ) );
		group.add( new IFrameElement( 'obXCyi2BLpo', 240, 280, 0, Math.PI / 2 ) );
		group.add( new IFrameElement( 'Eed2TwPUx5s', 0, 280, - 240, Math.PI ) );
		group.add( new IFrameElement( '6zyD7jsjc5M', - 240, 280, 0, - Math.PI / 2 ) );
		arWorldRoot.add( group );

		var image = new Image( 'content/ResoSante_logo_flower.svg', -30, 0, 0, - Math.PI / 2);
		arWorldRoot.add( image );

		var floor = new Floor( 'content/table.jpg', 0, -1, 0, - Math.PI / 2);
		arWorldRoot.add( floor );

		//////////////////////////////////////////////////////////////////////////////////
		//		render the whole thing on the page
		//////////////////////////////////////////////////////////////////////////////////

		// render the scene
		onRenderFcts.push(function(){
			renderer.render( arWorldRoot, camera );
		})

		// run the rendering loop
		var lastTimeMsec= null
		requestAnimationFrame(function animate(nowMsec){
			// keep looping
			requestAnimationFrame( animate );
			controls.update(); // only required if controls.enableDamping = true, or if controls.autoRotate = true
			// measure time
			lastTimeMsec	= lastTimeMsec || nowMsec-1000/60
			var deltaMsec	= Math.min(200, nowMsec - lastTimeMsec)
			lastTimeMsec	= nowMsec
			// call each update function
			onRenderFcts.forEach(function(onRenderFct){
				onRenderFct(deltaMsec/1000, nowMsec/1000)
			})
		})
		</script>
	</body>
</html>